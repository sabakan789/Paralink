<div class="wrapper">
  <% if logged_in? %>
    <div class="container add-color default-container">
      <%= link_to "キーワードで検索する", micropost_search_path ,class: 'col-md-offset-9 col-md-3 btn btn-white'%>
      <h1 class="text-white text-center">みんなの投稿</h1>
      <% @microposts.order('created_at DESC').each do |micropost| %>
        <div class="row">
          <div class="micropost-conteiner col-md-offset-2 col-md-8">
            <h2 class="micropost-user-name">
              <%= link_to micropost.user.name ,user_path(micropost.user), :style=>"color:white;"%>
            </h2>
            <%= link_to micropost_path(micropost), :style=>"color:white;" do %>
              <div class="micropost-content col-md-8">
                <%= micropost.content %>
              </div>
            <% end %>
            <div class="row">
              <% micropost.topics.each do |topic| %>
                <div class="col-md-3 index-image">
                  <%= link_to micropost_path(topic.micropost) do %>
                    <%= image_tag topic.image.url , alt:'topic.description',class: "img-responsive center-block"%>
                  <% end %>
                </div>
              <% end %>
            </div>
            <div class="col-md-3 comment-count">
              コメント数：<%= micropost.comments.count %>
            </div>
            <div class="col-md-3">
              <% if !micropost.favorite_users.include?(current_user) %>
                <%= link_to favorites_path(micropost_id: micropost.id), method: :post do %>
                  <i class="far fa-heart" aria-hidden="true"></i>
                <% end %>
              <% else %>
                <%= link_to favorites_path(micropost_id: micropost.id), method: :delete do %>
                  <i class="fa fa-heart" aria-hidden="true"></i>
                <% end %>
              <% end %>
            <%= micropost.favorite_users.count %>
            </div>
            <div class="col-md-3">
              <% if current_user != micropost.user %>
                <% if micropost.user.followed_by?(current_user) %>
                  <%=link_to "フォロー済み", user_relationships_path(micropost.user.id), method: :delete , class: 'btn btn-following'%>
                <% else %>
                  <%=link_to "フォローする", user_relationships_path(micropost.user.id), method: :post , class: 'btn btn-follow'%>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      <div class="text-center">
        <%= paginate @microposts %>
      </div>
    </div>
  <% else %>
    <div class="container add-color default-container">
      <h1 class="text-white text-center">みんなの投稿</h1>
      <% @microposts.order('created_at DESC').each do |micropost| %>
        <div class="row">
          <div class=" micropost-conteiner col-md-offset-2 col-md-8">
            <h2 class="micropost-user-name">
              <%= micropost.user.name %>
            </h2>
            <div class="micropost-content col-md-8">
              <%= micropost.content %>
            </div>
            <div class="row">
              <% micropost.topics.each do |topic| %>
                <div class="col-md-3 index-image">
                  <%= image_tag topic.image.url , alt:'topic.description',class: "img-responsive center-block"%>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      <div class="text-center">
        <%= paginate @microposts %>
      </div>
    </div>
  <% end %>
</div>
